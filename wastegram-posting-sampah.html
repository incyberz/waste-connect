<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Wastegram ‚Äî Punya sampah, posting aja!</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { background: #f8f9fa; }
      .topbar { height: 64px; display:flex; align-items:center; gap:12px; }
      .logo-img { height:40px; width:auto; }
      .camera-card { max-width:540px; margin: 18px auto; }
      .camera-stage { background:#000; height:480px; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
      video, canvas, .preview-img { width:100%; height:100%; object-fit:cover; }
      .logo-watermark { position:absolute; top:12px; left:12px; opacity:0.85; height:40px; pointer-events:none; }
      .controls { display:flex; gap:.5rem; align-items:center; justify-content:center; }
      .capture-btn { width:68px; height:68px; border-radius:50%; border:6px solid #fff; background:#ff6b6b; box-shadow:0 6px 18px rgba(0,0,0,.25); }
      .small-thumb { width:54px; height:54px; object-fit:cover; border-radius:8px; }
      .hint { font-size:.9rem; color:#6c757d; }
      .tagline { font-weight:600; font-size:1.05rem; }
    </style>
  </head>
  <body>
    <nav class="navbar bg-white border-bottom">
      <div class="container-fluid">
        <div class="d-flex align-items-center topbar">
          <img src="image/logo-wastegram.png" alt="Wastegram" class="logo-img">
          <div>
            <div class="tagline">Wastegram ‚Äî Punya sampah, posting aja!</div>
            <div class="hint">Jepret sampah, bantu bersihkan lingkungan</div>
          </div>
        </div>
        <div>
          <button class="btn btn-outline-secondary" id="openGalleryBtn">Galeri</button>
        </div>
      </div>
    </nav>

    <main class="container camera-card">
      <div class="card shadow-sm">
        <div class="card-body p-0">
          <div class="camera-stage" id="cameraStage" style="background: url('image/kursi-rusak.jpg') no-repeat center center; 
       background-size: cover;">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" style="display:none"></canvas>
            <img id="previewImg" class="preview-img" style="display:none" alt="Preview">
            <!-- watermark logo -->
            <img src="image/wastegram-logo.png" class="logo-watermark" alt="logo">
            <div class="position-absolute bottom-0 start-0 end-0 p-3 bg-gradient" style="background:linear-gradient(180deg,rgba(0,0,0,0) 0%, rgba(0,0,0,0.45) 60%);">
              <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                  <img src="image/kursi-rusak.jpg" id="thumbPlaceholder" class="small-thumb border bg-white" alt="thumb">
                  <div>
                    <div class="text-white fw-semibold" id="locationText">Lokasi: Rumah Pa Solihin, RT03/05</div>
                    <div class="text-white small" id="timeText">Kursi Tuaku,, ambil aja!</div>
                  </div>
                </div>
                <div class="controls">
                  <button class="btn btn-sm btn-light" id="flipBtn">üîÑ</button>
                  <button class="btn btn-sm btn-light" id="flashBtn">‚ö°</button>
                  <button class="btn btn-sm btn-light" id="uploadBtn">üìÅ</button>
                </div>
              </div>
            </div>
          </div>

          <div class="p-3">
            <div class="d-flex justify-content-center align-items-center mb-2">
              <div class="d-flex justify-content-center align-items-center "  style='border-radius:50%; background: #cfc; border: solid 2px #ccc'>
		<div class='mb-2'>
                  <input type="file" id="fileInput" accept="image/*" style="display:none">
                  <button class="btn " id="captureBtn" style='font-size:200%;'>üì∏</button>
              	</div>
              </div>
            </div>

            <div class="mb-2">
              <textarea id="caption" class="form-control" rows="2" placeholder="Tulis caption... (mis. yang mau ambil aja kesini!)"></textarea>
            </div>

            





<div class="d-flex flex-column gap-2">

  <!-- PILIH KATEGORI -->
  <div>
    <label class="small text-muted">Pilah sampah terlebih dahulu:</label>
    <select id="kategoriSampah" class="form-select">
      <option value="" selected>Pilih kategori sampah...</option>
      <option value="organik">Organik</option>
      <option value="non-organik">Non-Organik</option>
    </select>
  </div>

  <!-- PILIH SUBKATEGORI (MUNCUL DINAMIS) -->
  <div id="subkategoriWrapper" class="d-none">
    <label class="small text-muted">Pilih jenis sampah:</label>
    <select id="subkategoriSampah" class="form-select">
      <!-- diisi via JS -->
    </select>
  </div>

  <!-- TOMBOL POSTING (MUNCUL SAAT VALID) -->
  <button id="postBtn" class="btn btn-primary w-100 d-none">
    üì∏ Posting
  </button>

  <!-- STATUS / PERINGATAN -->
  <div id="statusText" class="small text-danger d-none">
    Jika postingan tidak sesuai fakta, poin Anda akan berkurang.
  </div>

</div>

<script>
  const kategori = document.getElementById('kategoriSampah');
  const subwrapper = document.getElementById('subkategoriWrapper');
  const subkategori = document.getElementById('subkategoriSampah');
  const postBtn = document.getElementById('postBtn');
  const statusText = document.getElementById('statusText');

  const dataKategori = {
    "organik": [
      "Sampah dapur",
      "Sisa sayur/buah",
      "Daun/rumput",
      "Organik lainnya"
    ],
    "non-organik": [
      "Logam",
      "Kayu",
      "Plastik",
      "Kaca",
      "Non-organik lainnya"
    ]
  };

  kategori.addEventListener('change', () => {
    const val = kategori.value;

    // reset
    subkategori.innerHTML = "";
    postBtn.classList.add("d-none");
    statusText.classList.add("d-none");

    if (val === "") {
      subwrapper.classList.add("d-none");
      return;
    }

    // tampilkan subkategori
    subwrapper.classList.remove("d-none");

    // populate subkategori
    dataKategori[val].forEach(item => {
      const opt = document.createElement("option");
      opt.value = item;
      opt.textContent = item;
      subkategori.appendChild(opt);
    });

    // default option
    subkategori.insertAdjacentHTML('afterbegin', `<option value="" selected>Pilih jenis sampah...</option>`);
  });

  subkategori.addEventListener('change', () => {
    if (subkategori.value !== "") {
      postBtn.classList.remove("d-none");
      statusText.classList.remove("d-none");
    } else {
      postBtn.classList.add("d-none");
      statusText.classList.add("d-none");
    }
  });
</script>











          </div>
        </div>
      </div>

      <!-- Optional preview card -->
      <div class="mt-3 text-center">
        <small class="text-muted">Tip: Pastikan foto jelas ‚Äî ambil jarak yang pas agar jenis sampah terlihat.</small>
      </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const previewImg = document.getElementById('previewImg');
      const captureBtn = document.getElementById('captureBtn');
      const fileInput = document.getElementById('fileInput');
      const uploadBtn = document.getElementById('uploadBtn');
      const statusText = document.getElementById('statusText');
      const timeText = document.getElementById('timeText');
      const locationText = document.getElementById('locationText');
      const thumbPlaceholder = document.getElementById('thumbPlaceholder');

      let stream = null;
      let usingFrontCamera = false;

      // start camera if available
      async function startCamera() {
        try {
          stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: usingFrontCamera ? 'user' : 'environment' }, audio: false });
          video.srcObject = stream;
          video.style.display = 'block';
          previewImg.style.display = 'none';
          statusText.textContent = 'Kamera aktif';
        } catch (err) {
          console.warn('Camera not available, fallback to upload', err);
          video.style.display = 'none';
          statusText.textContent = 'Kamera tidak tersedia ‚Äî gunakan Upload';
        }
      }

      // capture frame
      function captureFrame() {
        if (!stream && video.style.display === 'none') {
          statusText.textContent = 'Tidak ada kamera aktif ‚Äî silakan Upload.';
          fileInput.click();
          return;
        }
        const w = video.videoWidth;
        const h = video.videoHeight;
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, w, h);
        // embed watermark logo at bottom-right
        const logo = new Image();
        logo.src = 'image/logo-wastegram.png';
        logo.onload = () => {
          const logoW = Math.round(w * 0.18);
          const logoH = Math.round(logo.height * (logoW / logo.width));
          ctx.globalAlpha = 0.9;
          ctx.drawImage(logo, w - logoW - 12, h - logoH - 12, logoW, logoH);
          ctx.globalAlpha = 1.0;
          const dataUrl = canvas.toDataURL('image/jpeg', 0.9);
          showPreview(dataUrl);
        };
      }

      function showPreview(dataUrl) {
        previewImg.src = dataUrl;
        previewImg.style.display = 'block';
        video.style.display = 'none';
        statusText.textContent = 'Foto siap diposting';
        thumbPlaceholder.src = dataUrl;
        const now = new Date();
        timeText.textContent = now.toLocaleString();
        // try geolocation
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(pos => {
            locationText.textContent = `Lokasi: ${pos.coords.latitude.toFixed(3)}, ${pos.coords.longitude.toFixed(3)}`;
          }, () => {
            locationText.textContent = 'Lokasi: (diabaikan)';
          });
        }
      }

      captureBtn.addEventListener('click', () => captureFrame());
      uploadBtn.addEventListener('click', () => fileInput.click());
      document.getElementById('openGalleryBtn').addEventListener('click', () => fileInput.click());

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          showPreview(ev.target.result);
        };
        reader.readAsDataURL(file);
      });

      document.getElementById('discardBtn').addEventListener('click', () => {
        previewImg.style.display = 'none';
        previewImg.src = '';
        if (stream) { video.style.display = 'block'; }
        statusText.textContent = 'Dibatalkan';
      });

      document.getElementById('postBtn').addEventListener('click', () => {
        if (!previewImg.src) {
          alert('Belum ada foto untuk diposting.');
          return;
        }
        const payload = {
          image: previewImg.src,
          caption: document.getElementById('caption').value,
          time: new Date().toISOString()
        };
        // Simulasi POST (developer: ganti dengan request fetch ke endpoint Anda)
        console.log('Ready to post:', payload);
        statusText.textContent = 'Terposting (simulasi)';
        alert('Foto berhasil "diposting" (ini simulasi). Lihat console untuk payload.');
      });

      document.getElementById('flipBtn').addEventListener('click', async () => {
        usingFrontCamera = !usingFrontCamera;
        if (stream) {
          // stop existing tracks
          stream.getTracks().forEach(t => t.stop());
        }
        await startCamera();
      });

      document.getElementById('flashBtn').addEventListener('click', () => {
        // Placeholder: Web flash control is limited. Provide feedback animation.
        const stage = document.getElementById('cameraStage');
        stage.animate([{ opacity: 1 }, { opacity: 0.4 }, { opacity: 1 }], { duration: 220 });
      });

      // init
      startCamera();

    </script>
  </body>
</html>
